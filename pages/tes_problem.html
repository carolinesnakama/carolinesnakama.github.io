<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Thermal Energy Storage Problem · MPCC Library</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">MPCC Library</span></div><form class="docs-search" action="../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Introduction</a></li><li><a class="tocitem" href="flash_problem.html">Flash Tank Problem</a></li><li class="is-active"><a class="tocitem" href="tes_problem.html">Thermal Energy Storage Problem</a></li><li><a class="tocitem" href="biopt_problem.html">Bilevel Optimization Problem</a></li><li><a class="tocitem" href="mpec_collection.html">MPEC Collection</a></li><li><a class="tocitem" href="mpcc_methods.html">Methods</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="tes_problem.html">Thermal Energy Storage Problem</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="tes_problem.html">Thermal Energy Storage Problem</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Process-Optimization-and-Control/MPCCLibrary/blob/master/docs/src/pages/tes_problem.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Thermal-Energy-Storage-Problem"><a class="docs-heading-anchor" href="#Thermal-Energy-Storage-Problem">Thermal Energy Storage Problem</a><a id="Thermal-Energy-Storage-Problem-1"></a><a class="docs-heading-anchor-permalink" href="#Thermal-Energy-Storage-Problem" title="Permalink"></a></h1><h4 id="Description"><a class="docs-heading-anchor" href="#Description">Description</a><a id="Description-1"></a><a class="docs-heading-anchor-permalink" href="#Description" title="Permalink"></a></h4><p>Water returns from the district at <span>$T_\text{dh,ret}$</span> with a constant flow <span>$q_\text{dh}$</span> and is mainly heated in the waste heat boiler (WHB). Heat supply to WHB <span>$Q_\text{whb}$</span> fluctuates, thus an additional boiler that uses fossil fuel (PHB) is also necessary for periods when heat demand is higher than the supply to WHB. However, to minimize fuel consumption, an energy storage tank (TES) can be used to store energy when supply is higher than demand and this energy can be later used when <span>$Q_\text{whb}$</span> is not sufficient. The goal here is to find an operation that minimizes <span>$Q_\text{phb}$</span> given a profile of <span>$Q_\text{whb}$</span> for a time period. A scheme of this problem is presented below. </p><p><img src="../images/tes_scheme.svg" alt="tes_scheme"/></p><p>Here <span>$q_A$</span> and <span>$q_B$</span> correspond, respectively, to the flow associated with charging and discharging the energy storage tank (TES). Note that volume <span>$V_\text{tes}$</span> is constant, which means that if, for example, TES is discharging, there is a flow equals to <span>$q_A$</span> of water that returned from the district going straight to TES. </p><p>Mathematically, the problem is modeled as</p><div>\[    \begin{aligned}
        \min_{x,u,z} \quad &amp;\int Q_\text{phb}^2 dt \\
         \text{s.t.} \quad &amp;\frac{dT_\text{tes}}{dt} = \frac{q_\text{A}}{V_\text{tes}}(T_\text{A} - T_\text{tes}) + \frac{q_\text{B}}{V_\text{tes}}(T_\text{B} - T_\text{tes}) \\
                           &amp;\frac{dT_\text{phb}}{dt} = \frac{q_\text{dh}}{V_\text{phb}}(T_\text{C} - T_\text{phb}) + \frac{Q_\text{phb}}{V_\text{phb}\rho_\text{dh}Cp_\text{dh}} \\
                           &amp;\frac{dT_\text{whb}}{dt} = \frac{q_\text{whb}}{V_\text{whb}}(T_\text{A} - T_\text{whb}) + \frac{Q_\text{whb}}{V_\text{whb}\rho_\text{dh}Cp_\text{dh}} \\
                           &amp;q_\text{bypass} = q_\text{dh} - q_\text{A} + q_\text{B} - q_\text{whb} \\
                           &amp;T_\text{A} = \frac{q_\text{dh}T_\text{dh,ret} + q_\text{B}T_\text{tes}}{q_\text{dh} + q_\text{B}} \\
                           &amp;T_\text{B} = \frac{q_\text{whb}T_\text{whb} + q_\text{A}T_\text{tes}}{q_\text{whb} + q_\text{A}} \\
                           &amp;T_\text{C} = \frac{q_\text{bypass}T_\text{A} + (q_\text{dh} - q_\text{bypass})T_\text{B}}{q_\text{dh}} \\
                           &amp;0 \le q_\text{A} \perp q_\text{B} \ge 0
    \end{aligned}\]</div><p>where the state variables <span>$x$</span> are <span>$T_\text{tes}$</span>, <span>$T_\text{phb}$</span>, and <span>$T_\text{whb}$</span>, the control varaibles <span>$u$</span> are <span>$q_\text{whb}$</span>, <span>$q_\text{A}$</span>, <span>$q_\text{B}$</span>, and <span>$Q_\text{phb}$</span>, and the additional algebraic variables <span>$z$</span> are <span>$q_\text{bypass}$</span>, <span>$T_\text{A}$</span>, <span>$T_\text{B}$</span>, and <span>$T_\text{C}$</span>. The first three constraints correspond to the dynamic model of the state variables, the next three constraints are mass and energy balance equations (algebraic constraints) for mass and energy, and the last constraint correponds to the complementarity of variables <span>$q_A$</span> and <span>$q_B$</span>.</p><h4 id="Implementation"><a class="docs-heading-anchor" href="#Implementation">Implementation</a><a id="Implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation" title="Permalink"></a></h4><p>Values restrictions used for this example are <span>$q_\text{dh} = 10 \text{ m}^3/\text{h}$</span>, <span>$T_\text{dh,ret} = 30 ^\text{ o}\text{C}$</span>, <span>$60 ^\text{ o}\text{C} \le T_\text{phb} \le 70 ^\text{ o}\text{C}$</span>, and <span>$q_\text{whb} \le 15 \text{ m}^3/\text{h}$</span>, and the profile for <span>$Q_\text{whb}$</span> is shown in the figure below. Heat from WHB matches heat necessary to bring the returned water to <span>$60 ^\text{ o}\text{C}$</span> for the first 10 time intervals; then, it is increased in 20 % and later decrased in 20 %. </p><p><img src="../images/tes_input_example.svg" alt="tes_input_example"/></p><p>Instead of using the algorithm implementation available in this library, this problem is solved by simply adding a penalty term of the form <span>$k_cq_Aq_B$</span>, where <span>$k_c$</span> is a tuning parameter, to the objective function to enforce the complementarity condition(s). In addition, this problem has too many degrees of freedom and multiple solutions, and two different approaches for restricting the problem to one solution is implemented. In <a href="https://github.com/Process-Optimization-and-Control/MPCCLibrary/blob/main/scripts/tes_reg.jl">tes_reg.jl</a> regularization terms were added to the objective function to enforce some desired behaviour (for example, avoiding frequent swaps between <span>$q_A$</span> and <span>$q_B$</span>). In <a href="https://github.com/Process-Optimization-and-Control/MPCCLibrary/blob/main/scripts/tes_logic.jl">tes_logic.jl</a>, two logical constraints are added as complementatity constraints, more especifically, </p><div>\[    0 \le T_\text{phb,ub} - \text{min}(T_B, T_\text{phb,ub}) \perp q_\text{bypass} \ge 0\]</div><p>and</p><div>\[    0 \le q_\text{whb,ub} - q_\text{whb} \perp T_\text{phb} - T_\text{phb,lb} \ge 0. \]</div><p>The first constraint can be read as</p><div>\[    \begin{aligned}
        &amp;\text{if } T_\text{B} &gt; T_\text{phb,ub} \\
        &amp;\quad \quad q_\text{bypass} &gt; 0 \\
        &amp;\text{otherwise} \\
        &amp;\quad \quad q_\text{bypass} = 0. 
    \end{aligned}\]</div><p>Note that it has the minimum operator, which can be written as another complementary constraint using auxiliary variables (see Powell et al, 2016<sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup>). The second constraint says that if WHB hasn&#39;t reached full capacity, <span>$T_\text{phb}$</span> should be kept at the minimum bound so that all excess energy provided to WHB can be kept within the system.</p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a><a href="https://www.mdpi.com/2227-9717/4/1/7">Powell, K.M., Eaton, A.N., Hedengren, J.D. and Edgar, T.F. A continuous formulation for logical decisions in differential algebraic systems using mathematical programs with complementarity constraints. <em>Processes</em>, 4(1), p.7, 2016.</a></li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="flash_problem.html">« Flash Tank Problem</a><a class="docs-footer-nextpage" href="biopt_problem.html">Bilevel Optimization Problem »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 25 January 2021 18:15">Monday 25 January 2021</span>. Using Julia version 1.5.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
